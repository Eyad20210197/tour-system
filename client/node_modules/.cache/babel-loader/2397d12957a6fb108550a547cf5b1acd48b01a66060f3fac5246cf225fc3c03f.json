{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\DELL\\\\source\\\\repos\\\\Tour System Web Application\\\\client\\\\src\\\\pages\\\\public\\\\TourDetails.jsx\",\n  _s = $RefreshSig$();\nimport { useEffect, useState, useContext } from \"react\";\nimport { useParams, useNavigate } from \"react-router-dom\";\nimport { AuthContext } from \"../../context/AuthContext\";\nimport { getTourById, createBooking, updateTour } from \"../../api/api\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nfunction TourDetails() {\n  _s();\n  const {\n    id\n  } = useParams();\n  const navigate = useNavigate();\n  const {\n    user\n  } = useContext(AuthContext);\n  const [tour, setTour] = useState(null);\n  const [message, setMessage] = useState(\"\");\n  useEffect(() => {\n    getTourById(id).then(res => setTour(res.data)).catch(err => console.error(\"Error fetching tour details:\", err));\n  }, [id]);\n  const handleBooking = () => {\n    if (!user) {\n      setMessage(\"You must be logged in to book a tour.\");\n      return;\n    }\n    if (tour.seats === 0) {\n      setMessage(\"No seats available for this tour.\");\n      return;\n    }\n    const bookingData = {\n      tourId: tour.id,\n      userId: user.id,\n      username: user.username,\n      tourName: tour.name,\n      price: tour.price,\n      status: \"pending\",\n      agencyId: tour.agencyId || null,\n      agencyName: tour.agencyName || \"Unknown\"\n    };\n    createBooking(bookingData).then(() => {\n      // Update the seats\n      return updateTour(tour.id, {\n        ...tour,\n        seats: tour.seats - 1\n      });\n    }).then(() => {\n      setMessage(\"Booking request sent! Waiting for agency approval.\");\n      setTour(prev => ({\n        ...prev,\n        seats: prev.seats - 1\n      }));\n      setTimeout(() => {\n        if (user.role === \"tourist\") {\n          navigate(\"/dashboard/tourist\");\n        } else if (user.role === \"guide\") {\n          navigate(\"/dashboard/guide\");\n        } else if (user.role === \"admin\") {\n          navigate(\"/dashboard/admin\");\n        } else {\n          navigate(\"/\");\n        }\n      }, 1000);\n    }).catch(err => {\n      console.error(\"Error sending booking request:\", err);\n      setMessage(\"Booking failed.\");\n    });\n  };\n  if (!tour) return /*#__PURE__*/_jsxDEV(\"p\", {\n    children: \"Loading tour details...\"\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 68,\n    columnNumber: 23\n  }, this);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"tour-details\",\n    style: {\n      backgroundImage: `url(${tour.imageUrl})`,\n      backgroundSize: 'cover',\n      backgroundPosition: 'center',\n      padding: '40px',\n      color: 'white',\n      minHeight: '100vh'\n    },\n    children: /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"card\",\n      children: [/*#__PURE__*/_jsxDEV(\"h1\", {\n        children: tour.name\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 80,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n        children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n          children: \"Category:\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 81,\n          columnNumber: 20\n        }, this), \" \", tour.category]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 81,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n        children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n          children: \"Price:\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 82,\n          columnNumber: 20\n        }, this), \" $\", tour.price]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 82,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n        children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n          children: \"Duration:\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 83,\n          columnNumber: 20\n        }, this), \" \", tour.duration]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 83,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n        children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n          children: \"Seats Available:\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 84,\n          columnNumber: 20\n        }, this), \" \", tour.seats]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 84,\n        columnNumber: 17\n      }, this), message && /*#__PURE__*/_jsxDEV(\"p\", {\n        style: {\n          color: \"green\"\n        },\n        children: message\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 85,\n        columnNumber: 29\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: handleBooking,\n        children: \"Book Now\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 86,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 79,\n      columnNumber: 13\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 71,\n    columnNumber: 9\n  }, this);\n}\n_s(TourDetails, \"eN0IbappzVTzt+sFhC+SwvOhumg=\", false, function () {\n  return [useParams, useNavigate];\n});\n_c = TourDetails;\nexport default TourDetails;\nvar _c;\n$RefreshReg$(_c, \"TourDetails\");","map":{"version":3,"names":["useEffect","useState","useContext","useParams","useNavigate","AuthContext","getTourById","createBooking","updateTour","jsxDEV","_jsxDEV","TourDetails","_s","id","navigate","user","tour","setTour","message","setMessage","then","res","data","catch","err","console","error","handleBooking","seats","bookingData","tourId","userId","username","tourName","name","price","status","agencyId","agencyName","prev","setTimeout","role","children","fileName","_jsxFileName","lineNumber","columnNumber","className","style","backgroundImage","imageUrl","backgroundSize","backgroundPosition","padding","color","minHeight","category","duration","onClick","_c","$RefreshReg$"],"sources":["C:/Users/DELL/source/repos/Tour System Web Application/client/src/pages/public/TourDetails.jsx"],"sourcesContent":["import { useEffect, useState, useContext } from \"react\";\r\nimport { useParams, useNavigate } from \"react-router-dom\";\r\nimport { AuthContext } from \"../../context/AuthContext\";\r\nimport { getTourById, createBooking, updateTour } from \"../../api/api\";\r\n\r\nfunction TourDetails() {\r\n    const { id } = useParams();\r\n    const navigate = useNavigate();\r\n    const { user } = useContext(AuthContext);\r\n    const [tour, setTour] = useState(null);\r\n    const [message, setMessage] = useState(\"\");\r\n\r\n    useEffect(() => {\r\n        getTourById(id)\r\n            .then((res) => setTour(res.data))\r\n            .catch((err) => console.error(\"Error fetching tour details:\", err));\r\n    }, [id]);\r\n\r\n    const handleBooking = () => {\r\n        if (!user) {\r\n            setMessage(\"You must be logged in to book a tour.\");\r\n            return;\r\n        }\r\n\r\n        if (tour.seats === 0) {\r\n            setMessage(\"No seats available for this tour.\");\r\n            return;\r\n        }\r\n\r\n        const bookingData = {\r\n            tourId: tour.id,\r\n            userId: user.id,\r\n            username: user.username,\r\n            tourName: tour.name,\r\n            price: tour.price,\r\n            status: \"pending\",\r\n            agencyId: tour.agencyId || null,\r\n            agencyName: tour.agencyName || \"Unknown\"\r\n        };\r\n\r\n        createBooking(bookingData)\r\n            .then(() => {\r\n                // Update the seats\r\n                return updateTour(tour.id, { ...tour, seats: tour.seats - 1 });\r\n            })\r\n            .then(() => {\r\n                setMessage(\"Booking request sent! Waiting for agency approval.\");\r\n                setTour(prev => ({ ...prev, seats: prev.seats - 1 }));\r\n\r\n                setTimeout(() => {\r\n                    if (user.role === \"tourist\") {\r\n                        navigate(\"/dashboard/tourist\");\r\n                    } else if (user.role === \"guide\") {\r\n                        navigate(\"/dashboard/guide\");\r\n                    } else if (user.role === \"admin\") {\r\n                        navigate(\"/dashboard/admin\");\r\n                    } else {\r\n                        navigate(\"/\");\r\n                    }\r\n                }, 1000);\r\n            })\r\n            .catch((err) => {\r\n                console.error(\"Error sending booking request:\", err);\r\n                setMessage(\"Booking failed.\");\r\n            });\r\n    };\r\n\r\n    if (!tour) return <p>Loading tour details...</p>;\r\n\r\n    return (\r\n        <div className=\"tour-details\" style={{\r\n            backgroundImage: `url(${tour.imageUrl})`,\r\n            backgroundSize: 'cover',\r\n            backgroundPosition: 'center',\r\n            padding: '40px',\r\n            color: 'white',\r\n            minHeight: '100vh'\r\n        }}>\r\n            <div className=\"card\">\r\n                <h1>{tour.name}</h1>\r\n                <p><strong>Category:</strong> {tour.category}</p>\r\n                <p><strong>Price:</strong> ${tour.price}</p>\r\n                <p><strong>Duration:</strong> {tour.duration}</p>\r\n                <p><strong>Seats Available:</strong> {tour.seats}</p>\r\n                {message && <p style={{ color: \"green\" }}>{message}</p>}\r\n                <button onClick={handleBooking}>Book Now</button>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n\r\nexport default TourDetails;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}